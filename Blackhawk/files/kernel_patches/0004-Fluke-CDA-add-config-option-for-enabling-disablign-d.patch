From aebe0b6b1bb6136da6914f2098d520f558a155cb Mon Sep 17 00:00:00 2001
From: Frank Mori Hess <fmh6jj@gmail.com>
Date: Fri, 12 Mar 2021 08:19:29 -0800
Subject: [PATCH 4/4] Fluke CDA: add config option for enabling/disablign div
 instruction

---
 arch/nios2/Kconfig  | 6 ++++++
 arch/nios2/Makefile | 1 +
 2 files changed, 7 insertions(+)

diff --git a/arch/nios2/Kconfig b/arch/nios2/Kconfig
index e3fa8fe7e7b..bbf4c4824dc 100644
--- a/arch/nios2/Kconfig
+++ b/arch/nios2/Kconfig
@@ -246,6 +246,12 @@ config NIOS2_HW_MULX
 	
 endchoice
 
+config NIOS2_HW_DIV_SUPPORT
+	bool "Enable DIV instruction"
+	help
+	  Set to true if you configured the Nios II to include the DIV
+	  instruction.  Enables the -mhw-div compiler flag.
+
 comment 'Platform drivers Options'
 
 config GENERIC_GPIO
diff --git a/arch/nios2/Makefile b/arch/nios2/Makefile
index 92604bfbb65..be77008d5dc 100644
--- a/arch/nios2/Makefile
+++ b/arch/nios2/Makefile
@@ -51,6 +51,7 @@ cpu-cflags-$(CONFIG_NIOS2_HW_MUL_OFF) += -mno-hw-mul -mno-hw-mulx
 cpu-cflags-$(CONFIG_NIOS2_HW_MUL) += -mhw-mul -mno-hw-mulx
 cpu-cflags-$(CONFIG_NIOS2_HW_MULX) += -mhw-mul -mhw-mulx
 KBUILD_CFLAGS += $(cpu-cflags-y)
+KBUILD_CFLAGS += $(if $(CONFIG_NIOS2_HW_DIV_SUPPORT),-mhw-div,-mno-hw-div)
 
 # mulx flags currently cause older version of nios2-elf-gcc to fail
 # The following line ensures that all mulx flags are removed before
-- 
2.17.1

